import pandas as pd
import numpy as np

# Read the CSV file
# Note: There are leading spaces in some column names, so strip them for easier handling

df = pd.read_csv("C:\\Users\\lenovo\\OneDrive\\Pictures\\dsbda\\input_csvfile\\Student Performance.csv")
df.columns = df.columns.str.strip()  # Remove leading/trailing spaces from column names
print("Columns in the dataset:", df.columns.tolist())

# Step 1: Scan for missing values
print("Missing values in each column:\n", df.isnull().sum())

# Step 2: Handle missing values (e.g., Imputation)
# Impute numerical columns with the mean or median (if appropriate)
df['Math Score'] = df['Math Score'].fillna(df['Math Score'].mean())
df['Placement Score'] = df['Placement Score'].fillna(df['Placement Score'].mean())
# No 'Age' column, so skipping that step

# Step 3: Scan for inconsistencies (e.g., negative scores)
df['Math Score'] = df['Math Score'].apply(lambda x: x if x >= 0 else np.nan)
df['Placement Score'] = df['Placement Score'].apply(lambda x: x if x >= 0 else np.nan)

# After handling inconsistencies
print("\nData after handling missing values and inconsistencies:")
print(df)

# Step 1: Scan for outliers using IQR method
Q1 = df[['Math Score', 'Placement Score']].quantile(0.25)
Q3 = df[['Math Score', 'Placement Score']].quantile(0.75)
IQR = Q3 - Q1

# Outlier condition (values outside the range [Q1 - 1.5*IQR, Q3 + 1.5*IQR])
outliers = ((df[['Math Score', 'Placement Score']] < (Q1 - 1.5 * IQR)) | 
            (df[['Math Score', 'Placement Score']] > (Q3 + 1.5 * IQR)))

# Checking for outliers
print("\nOutliers detected:\n", outliers)

# Step 2: Handle outliers by capping them at the IQR bounds
df[['Math Score', 'Placement Score']] = df[['Math Score', 'Placement Score']].apply(
    lambda x: np.clip(x, Q1[x.name] - 1.5 * IQR[x.name], Q3[x.name] + 1.5 * IQR[x.name])
)

print("\nData after handling outliers:")
print(df)

import matplotlib.pyplot as plt
import seaborn as sns
from scipy.stats import skew

# Step 1: Visualize the distribution of Math Score
sns.histplot(df['Math Score'], kde=True)
plt.title('Distribution of Math Score')
plt.show()

# Check skewness before transformation
print("\nSkewness before transformation:", skew(df['Math Score']))

# Step 2: Apply log transformation to Math Score (only for positive values)
df['Math Score'] = np.log1p(df['Math Score'])  # log1p is log(1 + x)

# Visualize again after transformation
sns.histplot(df['Math Score'], kde=True)
plt.title('Distribution of Transformed Math Score')
plt.show()

# Check skewness after transformation
print("\nSkewness after transformation:", skew(df['Math Score']))
